class MVVM{static customEvents={};static directive(e,t){this.customEvents[e]=t}constructor(e={}){const t=this.#e(e);new Observer(e.data),document.addEventListener("DOMContentLoaded",(function(){new Compiler(document.body,t),t.ready&&t.ready(decodeURI(location.pathname),location.search.slice(1))})),document.addEventListener("deviceready",(()=>{t.onDeviceReady&&t.onDeviceReady()}),!1)}#e(e){return Object.keys(e).forEach((t=>{"function"==typeof e[t]&&(e.data[t]=e[t])})),e.data}}class Observer{constructor(e){this.observe(e)}observe(e){e&&"object"==typeof e&&Object.keys(e).forEach((t=>{this.observeObject(e,t,e[t])}))}observeObject(e,t,i){const s=new Dep;this.observeRecursive(i,s),Object.defineProperty(e,t,{enumerable:!0,configurable:!1,get:()=>(Dep.target&&s.addSub(Dep.target),i),set:e=>{i!==e&&(i=e,this.observeRecursive(i,s),s.notify())}})}observeRecursive(e,t){Array.isArray(e)?(e.__proto__=this.definePrototype(t),e.forEach((e=>this.observe(e)))):this.observe(e)}definePrototype(e){const t=Object.create(Array.prototype),i=this;return["push","pop","shift","unshift","splice","sort","reverse"].forEach((s=>{const r=t[s];Object.defineProperty(t,s,{enumerable:!0,writable:!0,configurable:!0,value:function(){const t=r.apply(this,arguments);let c=null;switch(s){case"push":case"unshift":c=arguments;break;case"splice":arguments.length>2&&(c=Array.prototype.slice.call(arguments,2))}return c&&i.observeRecursive(c,e),e.notify({method:s,args:arguments}),t}})})),t}}class Dep{constructor(){this.subs={}}addSub(e){this.subs[e.id]||(this.subs[e.id]=e)}removeSub(e){delete this.subs[e.id]}notify(e){Object.keys(this.subs).forEach((t=>{this.subs[t].update(e)}))}}class Watcher{static _id=0;constructor(e,t,i){this.scope=e,this.expr=t,this.callback=i,this.id=++Watcher._id,this.compute=Parser.buildFunction(t),this.update()}update(e){let t=this.get();t=null==t?"":t,this.callback(t,e)}get(){Dep.target=this;const e=this.compute(this.scope);return Dep.target=null,e}}class Directive{constructor(e,t,i){this.node=e,this.scope=t,Object.assign(this,i),this.init&&this.init(),this.expr&&this.update&&(this.watcher=new Watcher(this.scope,this.expr,((e,t)=>this.update(e,t))))}createAnchor(e){const t=document.createTextNode("");return(e=e||this.node).replace(t),t}}Directive.text={update(e){this.node.textContent=e}},Directive.attr={update(e){"data-src"==this.name?(this.node.removeAttribute("data-src"),this.node.setAttribute("src",e)):this.node.setAttribute(this.name,e)}},Directive.hidden={update(e){e?this.node.removeAttribute(this.name):this.node.setAttribute(this.name,!e)}},Directive.model={init(){this.node.removeAttribute(this.name),this.node.addEventListener("input",(()=>{this.node.isInputing=!0,eval("this.scope."+this.expr+"=e.currentTarget.value")})),this.node.addEventListener("blur",(()=>{this.node.isInputing=!1}))},update(e){this.node.isInputing||(this.node.value=e)}},Directive.event={init(){const e=this.scope[this.fn];if(this.node.removeAttribute("@"+this.name),"function"==typeof e){const t=MVVM.customEvents[this.name];t?t(this.node,(t=>{t.currentTarget=this.node,e.call(this.scope,t)})):this.node.addEventListener(this.name,(t=>{e.call(this.scope,t)}))}}},Directive.if={init(){const e=this.node.nextElementSibling;e&&e.hasAttribute("else")&&(e.removeAttribute("else"),this.elseNode=e,this.elseAnchor=this.createAnchor(e),this.compile(e,this.scope)),this.anchor=this.createAnchor(),this.compile(this.node,this.scope)},update(e){e?(this.anchor.replace(this.node),this.elseNode&&this.elseNode.replace(this.elseAnchor)):(this.node.replace(this.anchor),this.elseNode&&this.elseAnchor.replace(this.elseNode))}},Directive.foreach={init(){this.anchor=this.createAnchor(),this.itemNodes=[];const e=/\((.+),(.+)\)/,t=this.expr.match(/(.+) (?:in|of) (.+)/);if(t){this.expr=t[2],this.alias=t[1].trim();const i=t[1].match(e);i&&(this.alias=i[1].trim(),this.index=i[2].trim())}},update(e,t){let i=null;for(;i=this.itemNodes.pop();)i.remove();e&&e.forEach(((e,t)=>{const i=Object.create(this.scope);i[this.alias]=e,this.index&&(i[this.index]=t);const s=this.node.cloneNode(!0);this.anchor.insert(s),this.itemNodes.push(s),this.compile(s,i)}))}};class Compiler{constructor(e,t){const i=Compiler.createFragment(e);this.compile(i,t),e.appendChild(i)}createDirective(e,t,i){const s=Directive[i.type];s&&(Object.assign(i,s),i.compile=this.compile.bind(this),new Directive(e,t,i))}compile(e,t){1===e.nodeType&&"SCRIPT"!=e.tagName?this.compileElementNode(e,t):11===e.nodeType?this.compileElementNodes(e,t):3===e.nodeType&&this.compileTextNode(e,t)}compileElementNode(e,t){let i=Compiler.checkTerminalDirective(e);if(i)return e.removeAttribute(i.type),void this.createDirective(e,t,i);[].slice.call(e.attributes).forEach((s=>{i=Compiler.checkDirective(s),i&&this.createDirective(e,t,i)})),this.compileElementNodes(e,t)}compileElementNodes(e,t){const i=e.childNodes;i&&i.length&&i.forEach((e=>this.compile(e,t)))}compileTextNode(e,t){const i=e.wholeText.trim();if(i){const s=Parser.parseMustache(i);s&&this.createDirective(e,t,{type:"text",expr:s})}}static createFragment(e){const t=document.createDocumentFragment();let i=null;for(;i=e.firstChild;)this.isIgnorableNode(i)?e.removeChild(i):t.appendChild(i);return t}static isIgnorableNode(e){return 8==e.nodeType||3==e.nodeType&&/^[\t\n\r]+/.test(e.textContent)}static checkTerminalDirective(e){let t=null;return["foreach","if"].some((i=>{if(e.hasAttribute(i))return t={type:i,expr:e.getAttribute(i)}})),t}static checkDirective(e){if(0===e.name.indexOf("@"))return{type:"event",name:e.name.substring(1),fn:e.value};const t=e.name.match(/(hidden|model)/);if(t)return{type:t[1],name:e.name,expr:e.value};const i=Parser.parseMustache(e.value);return i?{type:"attr",name:e.name,expr:i}:void 0}}class Parser{static cache={};static regMustache=/\{\{(.+?)\}\}/g;static regSimple=/^[A-Za-z_$][\w$]*(?:\.[A-Za-z_$][\w$]*|\['.*?'\]|\[".*?"\]|\[\d+\]|\[[A-Za-z_$][\w$]*\])*$/;static regKeyword=/^(?:true|false|null|undefined|Infinity|NaN|Math)$/;static regQuote=/'(?:[^'\\]|\\.)*'|"(?:[^"\\]|\\.)*"/g;static regIdent=/[^\w$\.](?:[A-Za-z_$][\w$]*)/g;static parseMustache(e){const t=e.match(this.regMustache);if(t){const i=[];return e.split(this.regMustache).forEach((e=>{t.indexOf("{{"+e+"}}")>-1?i.push("("+e+")"):e&&i.push('"'+e+'"')})),i.join("+")}}static compute(e,t){return this.buildFunction(e)(t)}static buildFunction(e){let t=this.cache[e];if(!t){const i=this.isSimple(e)?"vm."+e:this.parseComplex(e);t=this.cache[e]=new Function("vm","return "+i)}return t}static isSimple(e){return this.regSimple.test(e)&&!this.regKeyword.test(e)}static parseComplex(e){const t=[];return e=(e=(" "+(e=(e=e.replace(this.regQuote,(e=>{const i=t.length;return t[i]=e,'"'+i+'"'}))).replace(/\s/g,""))).replace(this.regIdent,(e=>{const t=e.charAt(0),i=e.slice(1);return this.regKeyword.test(i)?e:t+"vm."+i}))).replace(/"(\d+)"/g,((e,i)=>t[i]))}}[Element,Text,DocumentFragment].forEach((e=>{Object.assign(e.prototype,{insert(e){return this.parentNode&&this.parentNode.insertBefore(e,this)},replace(e){return this.parentNode&&this.parentNode.replaceChild(e,this)},remove(){return this.parentNode&&this.parentNode.removeChild(this)}})}));